jQuery(document).ready(function(){
    carouselSliderInit();
    sliderInit();
    check_if_in_view();
    fpCompareSlider();

    jQuery(window).on('scroll',function(){
        check_if_in_view();
        return false;

    });
});
jQuery(window).resize(function () {
    check_if_in_view();
    if(jQuery('.mt_slider').length){
      jQuery('.mt_slider').slick('setPosition');
    }
});
function sliderInit(){
    if(jQuery('.mt_slider').length){

        //set initial slide if specified in Gallery Page
        var startingSlideNumber = 0;

        if( jQuery('input[name=hidden_unique_slide]').length ) {
          var slide_name = jQuery('input[name=hidden_unique_slide]').val();
          if(slide_name) {
            var startingSlideNumber = parseInt(jQuery('.mt_slider').find('.mt_slide[data-slide-name="'+slide_name+'"]').not('div.slick-cloned').index());
            var startingSlideCaption = jQuery('.mt_slider').find('.mt_slide[data-slide-name="'+slide_name+'"]').attr('data-caption');            
            jQuery('p.mt_txt_intro').html(startingSlideCaption);
            if(startingSlideCaption == ''){
                jQuery('.mt_gallery_caption p.mt_txt_intro').addClass('no_caption');
            }
            else{
                jQuery('.mt_gallery_caption p.mt_txt_intro').removeClass('no_caption');
            }
            jQuery('span.currentSlide').html( (parseInt(startingSlideNumber)+1) );
          }          
        } 

        jQuery('.mt_slider').not('.slick-initialized').slick({
          initialSlide: startingSlideNumber,
          rows: 0,
          infinite: true,
          pauseOnHover: false,
          // focusOnChange: true,
          pauseOnFocus: false,
          zIndex: 0,
           useTransform: false
        });
        if(jQuery('.mt_banner .mt_slider').length){
          if(startingSlideNumber <= 0) {
            jQuery('.mt_banner .mt_slider').slick('slickSetOption', 'autoplay', true, true);
          }         
          if(!jQuery('#gallery_page').length){
            jQuery('.mt_banner .mt_slider').slick('slickSetOption', 'autoplaySpeed', 5000, true);
            jQuery('.mt_banner .mt_slider').slick('slickSetOption', 'arrows', false, true);
          }
          else{
            jQuery('.mt_banner .mt_slider').slick('slickSetOption', 'autoplaySpeed', 10000, true);
          }
          // jQuery('.mt_banner .mt_slider').slick('slickSetOption', 'focusOnChange', false, true);
          if(startingSlideNumber <= 0) {
            jQuery('.mt_banner .mt_slider').slick('slickPlay');
          } else {
            jQuery('.mt_banner .mt_slider').slick('slickPause');
            jQuery('.mt_play').addClass('paused');
          }         
        }

        if(jQuery('.mt_story_staff .mt_slider').length){
          jQuery('.mt_story_staff .mt_slider').slick('slickSetOption', 'adaptiveHeight', true, true);
          // jQuery('.mt_story_staff .mt_slider').slick('slickSetOption', 'focusOnChange', false, true);
        }
        
        /* slider focus shifting to current slide fo ADA reading*/
        // jQuery('.mt_slider').on('afterChange', function(event, slick, currentSlide){
        //       var currentSliderObj = jQuery('.mt_slider.in_view');
        //       var currentSlideLen = currentSliderObj.find('.mt_slide:not(.slick-cloned)').length;
        //       if(currentSlide != (currentSlideLen-1)){
        //         if((currentSliderObj.find('.slick-next').is(":focus") || currentSliderObj.find('.slick-prev').is(":focus") || currentSliderObj.find('.slick-active').is(":focus"))){
        //           currentSliderObj.find('.slick-current').focus();
        //         }
        //       }
        // });
    }
}
function carouselSliderInit(){
    if(jQuery('.mt_slider_carousel').length){
        jQuery('.mt_slider_carousel').slick({
          rows: 0,
          dots: true,
          arrows:false,
          infinite: false,
          slidesToShow: 3,
          slidesToScroll: 3,
          responsive: [
            {
              breakpoint: 900,
              settings: {
                slidesToShow: 2,
                slidesToScroll: 2
              }
            },
            {
              breakpoint: 769,
              settings: {
                slidesToShow: 1,
                slidesToScroll: 1
              }
            }
          ]
        });
    }
    
}
function fpCompareSlider() {
   if(jQuery('.mt_fp_compare_slider').length){
        jQuery('.mt_fp_compare_slider').slick({
          rows: 0,
          dots: false,
          arrows:false,
          infinite: false,
          slidesToShow: 4,
          slidesToScroll: 4,
          responsive: [
            {
              breakpoint: 991,
              settings: {
                slidesToShow: 2,
                slidesToScroll: 2
              }
            },
            {
              breakpoint: 769,
              settings: {
                slidesToShow: 2,
                slidesToScroll: 2
              }
            },
            {
              breakpoint: 480,
              settings: {
                slidesToShow: 1,
                slidesToScroll: 1
              }
            }
          ]
        });
    }
}

function check_if_in_view() {
  var window_height = window.innerHeight;
  var window_top_position = jQuery(window).scrollTop();
  var window_bottom_position = (window_top_position + window_height);
  var $animation_elements = jQuery('.mt_slider');
  jQuery.each($animation_elements, function() {
      var $element = jQuery(this);
      var element_height = $element.outerHeight();
      var element_top_position = $element.offset().top + jQuery('header').outerHeight() + 20;
      var element_bottom_position = (element_top_position + element_height) - jQuery('header').outerHeight() - 30;
   
      
      if ((element_bottom_position >= window_top_position) &&
          (element_top_position <= window_bottom_position)) { 
                /*element in view*/
              $animation_elements.removeClass('in_view');
        $element.addClass('in_view');
      } else {
                /*element out of view*/
        $element.removeClass('in_view');
      }
  });
}
